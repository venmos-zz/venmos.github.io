#+TITLE:       VPS 上安装 Dropbox
#+AUTHOR:      venmos
#+EMAIL:       venmos@fuck.gfw.es
#+DATE:        2012-04-12
#+URI:         /blog/%y/%m/%d/vps-install-dropbox
#+KEYWORDS:    vps, 安装, dropbox
#+TAGS:        linux,
#+LANGUAGE:    en
#+OPTIONS:     H:3 num:nil toc:nil \n:nil ::t |:t ^:nil -:nil f:t *:t <:t
#+DESCRIPTION: vps, 安装, dropbox

今天早上 Dropbox 给我发邮件,说我的账户免费空间已经满了…,由于上面都是需要同步的 重要文件,于是就用信用卡买了 Dropbox 最低一档的收费服务.

既然花钱买了,就得用到爆==).想来手头还有几个 VPS,以后就用 Dropbox 来同步备份吧,省的 浪费了花钱买来的空间==).

首先登陆 VPS,查看一下 VPS 是 64 位还是 32 位的:

#+begin_src 
sudo uname -a
#+end_src

如果显示 i686,则表示 32 位的系统,如果显示 x86_64,则是 64 位的系统.

然后来下载 Dropbox:

- 下载 32 位版本:

#+begin_src 
wget -O dropbox.tar.gz “http://www.dropbox.com/download/?plat=lnx.x86”
#+end_src

- 下载 64 位版本:

#+begin_src
wget -O dropbox.tar.gz “http://www.dropbox.com/download/?plat=lnx.x86_64”
#+end_src

下载完成后解压缩:

#+begin_src
tar -xzvf dropbox.tar.gz
#+end_src

运行账户配置:

#+begin_src 
~/.dropbox-dist/dropboxd
#+end_src

运行完账户配置后,会提示给你一个连接,用游览器打开这个连接,输入你的 Dropbox 账户和 密码就会自动配置账户了.

手动启动 Dropbox:

#+begin_src 
~/.dropbox-dist/dropbox
#+end_src

为了方便,也可以写一个启动脚本,像通常服务器那样在 init.d 里 start,stop:

#+begin_src
vim /etc/init.d/dropbox
#+end_src

在文件中粘贴以下内容:

- /etc/init.d/dropbox

#+begin_src
#!/bin/sh
# dropbox service
# Replace with linux users you want to run Dropbox clients for
DROPBOX_USERS="user1 user2"

DAEMON=.dropbox-dist/dropbox

start() {
    echo "Starting dropbox..."
    for dbuser in $DROPBOX_USERS; do
        HOMEDIR=`getent passwd $dbuser | cut -d: -f6`
        if [ -x $HOMEDIR/$DAEMON ]; then
            HOME="$HOMEDIR" start-stop-daemon -b -o -c $dbuser -S -u $dbuser -x $HOMEDIR/$DAEMON
        fi
    done
}

stop() {
    echo "Stopping dropbox..."
    for dbuser in $DROPBOX_USERS; do
        HOMEDIR=`getent passwd $dbuser | cut -d: -f6`
        if [ -x $HOMEDIR/$DAEMON ]; then
            start-stop-daemon -o -c $dbuser -K -u $dbuser -x $HOMEDIR/$DAEMON
        fi
    done
}

status() {
    for dbuser in $DROPBOX_USERS; do
        dbpid=`pgrep -u $dbuser dropbox`
        if [ -z $dbpid ] ; then
            echo "dropboxd for USER $dbuser: not running."
        else
            echo "dropboxd for USER $dbuser: running (pid $dbpid)"
        fi
    done
}

case "$1" in

    start)
        start
        ;;

    stop)
        stop
        ;;

    restart|reload|force-reload)
        stop
        start
        ;;

    status)
        status
        ;;

    *)
        echo "Usage: /etc/init.d/dropbox {start|stop|reload|force-reload|restart|status}"
        exit 1

esac
 
exit 0
#+end_src
完后之后赋予脚本执行权限:

#+begin_src
sudo chmod +x /etc/init.d/dropbox
#+end_src

把脚本添加到开机启动项中:

#+begin_src 
cd /etc/init.d/
sudo update-rc.d dropbox defaults
#+end_src

Dropbox 本身也提供一个 Python 写的脚本,用来控制客户端,你可以用以下办法使用:

下载脚本,然后赋予启动权限

#+begin_src 
wget -O ~/.dropbox/dropbox.py "http://www.dropbox.com/download?dl=packages/dropbox.py"
chmod 755 ~/.dropbox/dropbox.py
#+end_src

具体使用方法可用以下命令查看 help:

#+begin_src 
~/.dropbox/dropbox.py help
#+end_src

以上配置都完成后,就会发现你的~目录中有了 Dropbox 文件夹,此时 Dropbox 就安装成功了 ,可以使用它来备份服务器上的各种文件和程序了==)
