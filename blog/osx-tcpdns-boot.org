#+TITLE:       OS X 设置 Tcp-DNS
#+AUTHOR:      venmos
#+EMAIL:       venmos@fuck.gfw.es
#+DATE:        2012-08-27
#+URI:         /blog/%y/%m/%d/osx-configure-tcp-dns
#+KEYWORDS:    osx, tcpdns
#+TAGS:        osx,
#+LANGUAGE:    en
#+OPTIONS:     H:3 num:nil toc:nil \n:nil ::t |:t ^:nil -:nil f:t *:t <:t
#+DESCRIPTION: osx, tcpdns

由于一些莫名其妙的天灾原因,我们的DNS似乎总是傲娇不停,不愿意为我们指向正确的服务器IP呢(原因你懂的,亲!).

具体请在Terminal下尝试以下三条命令,并对比结果就会明白了呢,亲:

#+begin_src
$nslookup twitter.com
$nslookup twitter.com 8.8.8.8
$nslookup -vc twitter.com 8.8.8.8
#+end_src

PS:-vc表示强制以TCP协议联系DNS.

如果你看明白了以上,就会知道以下办法的原理了,亲.

- 首先请克隆git://github.com/reorx/Tcp-DNS-proxy.git到本地目录,或者 [[https://github.com/reorx/Tcp-DNS-proxy][电击这里]] 直接下载ZIP压缩包.

- 然后在终端输入以下命令,启动Tcp-DNS:

#+begin_src
$cd Tcp-DNS-proxy
$sudo python tcpdns.py
#+end_src

启动后不要关闭终端窗口,将本机DNS设置为127.0.0.1,然后在终端执行一下命令进行测试:

#+begin_src
$nslookup twitter.com
#+end_src

如果返回结果与nslookup -vc twitter.com 8.8.8.8相同,那么恭喜你亲,你已经脱离了DNS污染区!
当然为了方便使用,我们会想让Tcp-DNS在开机时自启动,我们可以用以下办法将其加入开机启动列表:

#+begin_src
$sudo vim /Library/LaunchDaemons/com.go.tcpdns.plist
#+end_src

将以下代码复制到其中:

#+begin_src
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN"
        "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
        <key>Label</key>
        <string>com.go.agent</string>
        <key>ProgramArguments</key>
        <array>
<string>python</string>
<string>你存放Tcp-DNS的绝对路径/tcpdns.py</string>
        </array>
        <key>RunAtLoad</key>
        <true/>
</dict>
</plist>
#+end_src

保存之后,每次开机时就会自动启动Tcp-DNS了呢,亲!

PS:Windows的亲们请看 [[http://opengg.me/815/tcp-dns-proxy-avoid-dns-poisoning/][这儿]] :)
