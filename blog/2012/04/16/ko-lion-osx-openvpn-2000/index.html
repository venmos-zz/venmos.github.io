<!DOCTYPE html>
<html lang="en-us">
  <head>
    <title>突破 Lion OS X OpenVPN Routes 2000 限制 - Time Machine</title>
    <meta charset="utf-8" />
    <meta name="author" content="venmos" />
    <meta name="description" content="突破, lionosx, openvpn, 2000, 限制" />
    <meta name="keywords" content="突破, lionosx, openvpn, 2000, 限制" />
    <link rel="stylesheet" href="/media/css/main.css" type="text/css">
    <link rel="stylesheet" href="/media/css/prettify.css" type="text/css">
  </head>
  <body class="container">
    <div>
      <header class="masthead">
        <h1 class="masthead-title"><a href="/">Time Machine</a></h1>
        <p>A website framework for hackers.</p>
        <ul>
          <li><a href="/blog/">Blog</a></li>
          <li><a href="/tags/">Tags</a></li>
          <li><a href="/about/">About</a></li>
          <li><a href="https://github.com/venmos">GitHub</a></li>
          <li><a href="/rss.xml">RSS</a></li>
        </ul>
        <form method="get" id="searchform" action="http://www.google.com/search">
          <input type="text" class="field" name="q" id="s" placeholder="Search">
          <input type="hidden" name="as_sitesearch" value="venmos.com">
        </form>
      </header>
    </div>

<div>
<div class="post">
<h1>突破 Lion OS X OpenVPN Routes 2000 限制</h1>
<p>
话说自从升级到了Lion之后,Routes超过2000就没连接成功过.所幸我的OpenVPN服务器网络速度很好,绕一圈回到国内也不会特别卡,就是看优酷什么的缓冲慢了一点点而已.
</p>

<p>
不过最近需要频繁的SSH到公司的服务器里去提交文件,不知道为什么从OpenVPN上绕一圈回来就单单登陆公司的服务器特别特别慢.有时候需要提交的文件多了,还必须先得断开OpenVPN. 一来二去的实在是烦了,开始翻OpenVPN的文档寻找解决办法,没想到翻了两页就找到办法了…
</p>

<p>
以前都是从OpenVPN里把国内的路由表(Chnroutes)写入,让国内的流量不走OpenVPN,但是不知道为什么Lion下的OpenVPN定义路由表一旦超过2000就会报错,甚至有的时候1500就会出错,而Chnroutes又写的非常详细,足足有接近4000条之多!
</p>

<p>
其实只要转换一下思维就行了,既然国内的路由表太多了写不进去,那就干脆直接写国外的路由表好了.让只有到北美(普遍莫名其妙上不去的一般都是北美的)的流量走OpenVPN不就OK了? PS:就这么简单的一个办法一开始我居然没有想到,愣是忍受了长达数天的巨慢国内速度,囧!
</p>

<p>
确定了解决方案就开始翻北美的路由表,不一会就从网上寻到一张简短的北美路由表:
</p>

<pre class="example">
# North American Routes 
route 24.0.0.0 255.0.0.0 vpn_gateway
route 63.0.0.0 255.0.0.0 vpn_gateway
route 64.0.0.0 255.0.0.0 vpn_gateway
route 65.0.0.0 255.0.0.0 vpn_gateway
route 66.0.0.0 255.0.0.0 vpn_gateway
route 67.0.0.0 255.0.0.0 vpn_gateway
route 68.0.0.0 255.0.0.0 vpn_gateway
route 69.0.0.0 255.0.0.0 vpn_gateway
route 70.0.0.0 255.0.0.0 vpn_gateway
route 71.0.0.0 255.0.0.0 vpn_gateway
route 72.0.0.0 255.0.0.0 vpn_gateway
route 73.0.0.0 255.0.0.0 vpn_gateway
route 74.0.0.0 255.0.0.0 vpn_gateway
route 75.0.0.0 255.0.0.0 vpn_gateway
route 76.0.0.0 255.0.0.0 vpn_gateway
route 96.0.0.0 255.0.0.0 vpn_gateway
route 97.0.0.0 255.0.0.0 vpn_gateway
route 98.0.0.0 255.0.0.0 vpn_gateway
route 99.0.0.0 255.0.0.0 vpn_gateway
route 108.0.0.0 255.0.0.0 vpn_gateway
route 173.0.0.0 255.0.0.0 vpn_gateway
route 174.0.0.0 255.0.0.0 vpn_gateway
route 184.0.0.0 255.0.0.0 vpn_gateway
route 199.0.0.0 255.0.0.0 vpn_gateway
route 204.0.0.0 255.0.0.0 vpn_gateway
route 205.0.0.0 255.0.0.0 vpn_gateway
route 206.0.0.0 255.0.0.0 vpn_gateway
route 207.0.0.0 255.0.0.0 vpn_gateway
route 208.0.0.0 255.0.0.0 vpn_gateway
route 209.0.0.0 255.0.0.0 vpn_gateway 
route 216.0.0.0 255.0.0.0 vpn_gateway
</pre>

<p>
将这张路由表复制到你的OpenVPN配置文件的结尾处,然后还需要在OpenVPN配置文件的开头写入:
</p>

<pre class="example">
max-routes 50
route-nopull
</pre>

<p>
然后还需要注意要把redirect-gateway注视掉.最后还需要添加你使用的国外DNS进去,让前往DNS的流量都走OpenVPN,以避免DNS污染.这一段最好添加到北美路由表的上方:
</p>

<pre class="example">
# Google DNS
route 8.8.8.0 255.255.255.0 vpn_gateway
route 8.8.4.0 255.255.255.0 vpn_gateway
</pre>

<p>
然后配置就结束了,以后当你连接OpenVPN后,除这张北美路由表之外的所有流量就会默认走你本地网关,而不是通过OpenVPN来走.
</p>

<p>
如果你发现了某个网站上不去,而你又非常想上,你可以先PING一下它的域名,把获得的IP地址输入到你的路由表之中就可以了. 比如ping exmaple.com,得到ip 123.123.123.123,只需在OpenVPN配置文件的结尾写入route 123.123.123.0 255.255.255.0 vpn_gateway,然后重连OpenVPN让配置文件生效就OK了!
</p>

</div>
</div>
    <div>
      <div class="post-meta">
        <span title="post date" class="post-info">2012-04-16</span>
        <span title="last modification date" class="post-info">2015-08-19</span>
        <span title="tags" class="post-info"><a href="/tags/osx/">osx</a></span>
        <span title="author" class="post-info">venmos</span>
      </div>
      <section>
        <h1>Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
          //var disqus_developer = 1;
          var disqus_identifier = "/blog/2012/04/16/ko-lion-osx-openvpn-2000";
          var disqus_url = "http://venmos.com/blog/2012/04/16/ko-lion-osx-openvpn-2000";
          var disqus_shortname = 'venomblog';
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      </section>
      <script src="http://code.jquery.com/jquery-latest.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/prettify.js"></script>
      <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="/media/js/main.js"></script>
      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-66388727-2']);
        _gaq.push(['_trackPageview']);
        (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>
      <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.x (<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
          Copyright &copy; 2012 - <span id="footerYear"></span> <a href="mailto:venmos &lt;at&gt; fuck &lt;dot&gt; gfw &lt;dot&gt; es">venmos</a>
          &nbsp;&nbsp;-&nbsp;&nbsp;
          Powered by <a href="https://github.com/kelvinh/org-page" target="_blank">org-page</a>
          <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
      </div>
    </div>

  </body>
</html>
